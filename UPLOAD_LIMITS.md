# 上传文件大小限制说明

## 🚨 重要：Vercel 免费版限制

### Vercel 免费版有以下硬性限制：
- **请求体大小**: 4.5MB
- **函数超时**: 10 秒
- **无法绕过**：这是 Vercel 平台的硬性限制

### 这意味着：
- ✅ 可以上传 < 4MB 的文件
- ⚠️  4-4.5MB 的文件可能成功，可能超时
- ❌ > 4.5MB 的文件**无法上传**（会报 413 错误）

---

## 📊 你的情况

### 前面成功上传的 3 个文件
这些文件应该都 < 4MB，所以成功了。

### 现在失败的文件
很可能 > 4.5MB，触发了 Vercel 的限制。

错误 "Unexpected token 'R'" 通常是：
```
Request Entity Too Large (413)
```

---

## 🛠️ 解决方案

### 方案 A：本地开发测试（立即可用）

本地开发没有文件大小限制：

```bash
cd D:\Users\Administrator\Desktop\ai-audio-reader
npm run dev
```

访问 http://localhost:3000 上传任意大小的文件。

### 方案 B：升级 Vercel Pro（推荐，如果需要大文件）

Vercel Pro 版本：
- **请求体大小**: 4.5MB（还是一样）
- **但可以用 Edge Functions**: 支持更大文件

**价格**: $20/月

### 方案 C：客户端直接上传（最佳方案 ⭐）

**不经过服务器**，客户端直接上传到 Supabase Storage：

优点：
- ✅ 没有大小限制（Supabase 免费版支持最大 50MB）
- ✅ 更快（不经过 Vercel）
- ✅ 节省 Vercel 带宽

需要修改代码，让上传组件直接调用 Supabase Storage API。

### 方案 D：使用其他部署平台

其他平台的限制：
- **Railway**: 100MB
- **Render**: 100MB
- **自己的服务器**: 无限制

---

## 💡 推荐做法

### 短期（现在）：
1. **本地测试大文件**：`npm run dev`
2. **线上只上传小文件**：< 4MB 的 PDF/EPUB

### 长期（如果需要大文件支持）：
实现**客户端直接上传**（方案 C），这是最佳方案。

---

## 🔧 我现在可以做什么？

### 选项 1：实现客户端直接上传（推荐）
- 修改上传组件
- 客户端直接调用 Supabase Storage
- 上传成功后再调用 API 保存书籍信息
- **时间**: 约 30 分钟

### 选项 2：添加文件大小预检查
- 在上传前检查文件大小
- 如果 > 4MB，提示用户文件太大
- **时间**: 5 分钟

### 选项 3：保持现状
- 本地测试大文件
- 线上只支持小文件
- 在 UI 上提示"文件需小于 4MB"

---

## 📝 你的选择？

请告诉我：
1. **失败文件的大小**是多少？
2. **你想要哪个解决方案**？
   - A: 本地测试就够了
   - B: 升级 Vercel Pro
   - C: 实现客户端直接上传（我推荐）
   - D: 换部署平台

我可以立即帮你实现！
